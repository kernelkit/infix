#!/bin/sh
# This script extracts the admin user's password hash from VPD

shell="$1"
pwhash="$(jq .pwhash /run/system.json)"

if [ -z "$pwhash" ] || [ "$pwhash" = "null" ]; then
    exit 1
fi

cat <<EOF
{
  "ietf-system:system": {
    "authentication": {
      "user": [
       {
          "name": "admin",
          "password": $pwhash,
	  "infix-system:shell": "$shell"
       }
      ]
    }
  }
}
EOF
